@using MoGYSD.Business.Persistence
@inject NavigationManager NavigationManager
@implements IDisposable
<div class="sidebar-container">
    <div class="sidemenu-container navbar-collapse collapse fixed-menu">
        <div id="remove-scroll" class="left-sidemenu">
            <ul class="sidemenu  page-header-fixed slimscroll-style" data-keep-expanded="false" data-auto-scroll="true"
                data-slide-speed="200" style="padding-top: 20px">
                <li class="sidebar-toggler-wrapper hide">
                    <div class="sidebar-toggler">
                        <span></span>
                    </div>
                </li>
                <li class="sidebar-user-panel">
                    <div class="sidebar-user">
                        <div class="sidebar-user-picture">
                            <img alt="image" src="../assets/img/logo.png">
                        </div>

                    </div>
                </li>
                <li class="nav-item @GetActiveClass("/", NavLinkMatch.All)">
                    <a href="/" class="nav-link nav-toggle">
                        <i class="fa fa-dashboard"></i>
                        <span class="title">Dashboard</span>
                        <span class="selected"></span>

                    </a>

                </li>

                @if (userProfile.Contains("PROGRAMME COMMUNITY VALIDATION:"))
                {
                    <li class="nav-item @GetActiveClass("/programcommunityvalidation")">
                        <NavLink href="/programcommunityvalidation" class="nav-link">
                            <i data-feather="user-check"></i>
                            <span class="title">Programme Community Validation</span>
                        </NavLink>
                    </li>
                }
                @if (userProfile.Contains("ELIGIBILITY TESTING & SELECTION:"))
                {
                    <li class="nav-item @GetActiveClass("/eligibility/eligibilitytesting")">
                        <NavLink href="/eligibility/eligibilitytesting" class="nav-link">
                            <i data-feather="activity"></i>
                            <span class="title">Eligibility Testing & Selection</span>
                        </NavLink>
                    </li>
                }
                @if (userProfile.Contains("ENROLMENT EVENT:"))
                {
                    <li class="nav-item @GetActiveClass("/Enrolment", NavLinkMatch.Prefix)">
                        <a href="javascript:;" class="nav-link nav-toggle">
                            <i data-feather="layout"></i>
                            <span class="title">Enrolment</span>
                            <span class="arrow"></span>
                        </a>
                        <ul class="sub-menu">
                            <li class="nav-item @GetActiveClass("/enrolment/events")">
                                <NavLink href="/enrolment/events" class="nav-link">
                                    <span class="title">Enrolment Events</span>
                                </NavLink>
                            </li>
                            <li class="nav-item @GetActiveClass("/enrolment/list")">
                                <NavLink href="/enrolment/list" class="nav-link">
                                    <span class="title">Enrolment List</span>
                                </NavLink>
                            </li>
                            <li class="nav-item @GetActiveClass("/enrolment/schedule")">
                                <NavLink href="/enrolment/schedule" class="nav-link">
                                    <span class="title">Schedule</span>
                                </NavLink>
                            </li>
                        </ul>
                    </li>
                }

                <li class="nav-item" style="display:none">
                    <a href="/" class="nav-link nav-toggle">
                        <i data-feather="dollar-sign"></i>
                        <span class="title">Payments</span> <span class="arrow"></span>
                    </a>
                    <ul class="sub-menu">
                        <li class="nav-item">
                            <a href="all_assets.html" class="nav-link ">
                                <span class="title">
                                    All Library
                                    Assets
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="add_library.html" class="nav-link ">
                                <span class="title">
                                    Add Library
                                    Asset
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="add_library_bootstrap.html" class="nav-link ">
                                <span class="title">
                                    Add
                                    Asset Bootstrap
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="edit_library.html" class="nav-link ">
                                <span class="title">
                                    Edit
                                    Asset
                                </span>
                            </a>
                        </li>
                    </ul>
                </li>
             
                <li class="nav-item" style="display:none">
                    <a href="/" class="nav-link nav-toggle">
                        <i class="fa fa-cubes"></i>
                        <span class="title">Compliance</span> <span class="arrow"></span>
                    </a>
                    <ul class="sub-menu">
                        <li class="nav-item">
                            <a href="/" class="nav-link ">
                                <span class="title">Policy Alignment</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="/" class="nav-link ">
                                <span class="title">
                                    Code of Conduct
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/" class="nav-link ">
                                <span class="title">
                                    Reporting & Audits
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/" class="nav-link ">
                                <span class="title">
                                    Accreditation Bodies
                                </span>
                            </a>
                        </li>

                    </ul>
                </li>
                @if (userProfile.Contains("SECURITY:"))
                {
                    <li class="nav-item @GetActiveClass("/security", NavLinkMatch.Prefix)">
                        <NavLink href="/" class="nav-link nav-toggle">
                            <i class="fas fa-shield-alt"></i>
                            <span class="title">Security</span> <span class="arrow"></span>
                        </NavLink>
                        <ul class="sub-menu">
                            @if (userProfile.Contains("ROLES:"))
                            {
                                <li class="nav-item @GetActiveClass("/security/roles")">
                                    <NavLink href="/security/roles" class="nav-link ">
                                        <span class="title">
                                            Roles
                                        </span>
                                    </NavLink>
                                </li>
                            }

                            @if (userProfile.Contains("PERMISSIONS:"))
                            {
                                <li class="nav-item @GetActiveClass("/security/profiles")">
                                    <NavLink href="/security/profiles" class="nav-link ">
                                        <span class="title">
                                            Permissions
                                        </span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("USERS:"))
                            {
                                <li class="nav-item @GetActiveClass("/security/user")">
                                    <NavLink href="/security/user" class="nav-link ">
                                        <span class="title">Users</span>
                                    </NavLink>
                                </li>
                            }
                        </ul>
                    </li>
                }
               
                @if (userProfile.Contains("SETTINGS:"))
                {
                    <li class="nav-item @GetActiveClass("/admin", NavLinkMatch.Prefix)">
                        <NavLink href="javascript:;" class="nav-link nav-toggle">
                            <i data-feather="settings"></i>
                            <span class="title">Settings</span>
                            <span class="arrow "></span>
                        </NavLink>
                        <ul class="sub-menu">
                            @if (userProfile.Contains("PROGRAMME CONFIGURATION:"))
                            {
                                <li class="nav-item @GetActiveClass("/programmes")">
                                    <NavLink href="/programmes" class="nav-link">
                                        <span class="title">Programme Configuration</span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("PROGRAMME ELIGIBILITY CRITERIA:")) 
                            {
                                <li class="nav-item @GetActiveClass("/programme/eligibilitycriteria")">
                                    <NavLink href="/programme/eligibilitycriteria" class="nav-link">
                                        <span class="title">Programme Eligibility Criteria</span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("FINANCIAL YEAR:"))
                            {
                                <li class="nav-item @GetActiveClass("/financialyear")">
                                    <NavLink href="/financialyear" class="nav-link">
                                        <span class="title">Financial Year</span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("BANKS:"))
                            {
                                <li class="nav-item @GetActiveClass("/banks")">
                                    <NavLink href="/banks" class="nav-link">
                                        <span class="title">Banks</span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("GRADES:"))
                            {
                                <li class="nav-item @GetActiveClass("/grade")">
                                    <NavLink href="/grade" class="nav-link">
                                        <span class="title">Grades</span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("FACILITY TYPE:"))
                            {
                                <li class="nav-item @GetActiveClass("/facilitytype")">
                                    <NavLink href="/facilitytype" class="nav-link">
                                        <span class="title">Facility Types</span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("FACILITIES:"))
                            {
                                <li class="nav-item @GetActiveClass("/facility")">
                                    <NavLink href="/facility" class="nav-link">
                                        <span class="title">Facilities</span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("GEOGRAPHICAL SETTINGS:"))
                            {
                                <li class="nav-item @GetActiveClass("/admin/country", NavLinkMatch.Prefix)">
                                    <NavLink href="javascript:;" class="nav-link nav-toggle">
                                        Geographical Settings
                                        <span class="arrow"></span>
                                    </NavLink>
                                    <ul class="sub-menu">
                                        <li class="nav-item @GetActiveClass("/admin/country", NavLinkMatch.All)">
                                            <NavLink href="/admin/country" class="nav-link ">
                                                <span class="title">
                                                    Country
                                                </span>
                                            </NavLink>
                                        </li>
                                        @if (userProfile.Contains("DISTRICT:"))
                                        {
                                            <li class="nav-item @GetActiveClass("/admin/districts")">
                                                <NavLink href="/admin/districts" class="nav-link ">
                                                    <span class="title">
                                                        Districts
                                                    </span>
                                                </NavLink>
                                            </li>
                                        }
                                        @if (userProfile.Contains("CONSTITUENCY:"))
                                        {
                                            <li class="nav-item @GetActiveClass("/admin/constituency")">
                                                <NavLink href="/admin/constituency" class="nav-link ">
                                                    <span class="title">
                                                        Constituencies
                                                    </span>
                                                </NavLink>
                                            </li>
                                        }
                                        @if (userProfile.Contains("COMMUNITY COUNCIL:"))
                                        {
                                            <li class="nav-item @GetActiveClass("/admin/councils")">
                                                <NavLink href="/admin/councils" class="nav-link ">
                                                    <span class="title">Community Council</span>
                                                </NavLink>
                                            </li>
                                        }
                                        @if (userProfile.Contains("VILLAGES:"))
                                        {
                                            <li class="nav-item @GetActiveClass("/admin/villages")">
                                                <NavLink href="/admin/villages" class="nav-link ">
                                                    <span class="title">
                                                        Villages
                                                    </span>
                                                </NavLink>
                                            </li>
                                        }
                                    </ul>
                                </li>
                            }
                            @if (userProfile.Contains("DISTRICT CENSUS DATA:"))
                            {
                                <li class="nav-item @GetActiveClass("/admin/districtcensushhdatas")">
                                    <NavLink href="/admin/districtcensushhdatas" class="nav-link ">
                                        <span class="title">
                                           Census Data
                                        </span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("REGISTRATION CENTRE:"))
                            {
                                <li class="nav-item @GetActiveClass("/admin/registrationcentre")">
                                    <NavLink href="/admin/registrationcentre" class="nav-link ">
                                        <span class="title">
                                            Registration Centres
                                        </span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("PARTNERS:"))
                            {
                                <li class="nav-item @GetActiveClass("/admin/partners")">
                                    <NavLink href="/admin/partners" class="nav-link ">
                                        <span class="title">
                                            Partners
                                        </span>
                                    </NavLink>
                                </li>
                            }
                            @if (userProfile.Contains("SYSTEM CODES:"))
                            {
                                <li class="nav-item @GetActiveClass("/admin/systemcodes")">
                                    <NavLink href="/admin/systemcodes" class="nav-link ">
                                        <span class="title">
                                            System Codes
                                        </span>
                                    </NavLink>
                                </li>
                            }
                        </ul>
                    </li>
                }              
            </ul>             
        </div>
    </div>
</div>

@code {
    private string userProfile;
    private string _currentUri;
    protected override async Task OnInitializedAsync()
    {
        await UserProfileService.InitializeAsync();
        userProfile = UserProfileService.UserProfile;

        _currentUri = NavigationManager.Uri;
        NavigationManager.LocationChanged += OnLocationChanged;
    }
    private void OnLocationChanged(object sender, LocationChangedEventArgs e)
    {
        _currentUri = e.Location;    
        StateHasChanged();
    }
    private string GetActiveClass(string href, NavLinkMatch match = NavLinkMatch.All)
    {
        var relativePath = "/" + NavigationManager.ToBaseRelativePath(_currentUri);

        if (match == NavLinkMatch.All)
        {          
            return relativePath.Equals(href, StringComparison.OrdinalIgnoreCase) ? "active" : "";
        }
        else 
        {
         
            if (relativePath.StartsWith(href, StringComparison.OrdinalIgnoreCase) && href != "/")
            {              
                return "active open";
            }
        }
        return "";
    }
    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}
